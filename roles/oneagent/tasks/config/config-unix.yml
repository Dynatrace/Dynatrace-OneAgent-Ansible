---
- name: Check if OneAgent is installed
  stat:
    path: "{{ oneagent_ctl_bin_path }}"
  register: _oneagent_ctl_state

- name: Applying OneAgent configuration
  command: "{{ oneagent_ctl_bin_path }} {{ _oneagent_all_config_args | join(' ') }}"
  no_log: true
  ignore_errors: true
  changed_when: true
  register: _oneagent_config_result
  when: _oneagent_ctl_state.stat.exists

- name: Verify configuration result
  debug:
    msg: "{{ oneagent_configuration_failed | format(_oneagent_config_result.rc,
      _oneagent_config_result.stdout, _oneagent_config_result.stderr) }}"
  when: _oneagent_ctl_state.stat.exists and _oneagent_config_result.failed|default(false)
